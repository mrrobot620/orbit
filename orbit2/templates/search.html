{% extends 'base.html' %}

{% block content %}
<style>
    .card:hover {
      transform: scale(1.05);
      transition: transform 0.3s ease;
    }

    .card {
      text-decoration: none;
      color: black; 
    }

    .card img {
      transition: filter 0.3s ease; /* Add a smooth transition for the filter property */
    }

    .card:hover img {
      filter: blur(1.5px); /* Apply a blur effect on hover */
    }

    /* Center the cards */
    .center-cards {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 65vh; /* Adjust the height to your preference */
    }

    /* Center the button */
    .center-button {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px; /* Adjust the margin as needed */
    }

    .btn {
        background-color: #212529;
        border-color: #212529;
    }
  </style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Page</title>
    <!-- Add Bootstrap CDN link -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <!-- Add Select2 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
<!-- Or for RTL support -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.rtl.min.css" />

</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-3">Orphan Reconcillation</h1>
        <form method="POST" action="{% url 'search' %}" enctype="multipart/form-data" id="searchForm">
            {% csrf_token %}            
            <div class="mb-4 d-flex justify-content-center">
                <img id="selectedImage" src="https://mdbootstrap.com/img/Photos/Others/placeholder.jpg"
                     alt="example placeholder" style="width: 300px;" />
            </div>

            <div class="mb-3">
                <label for="image" class="form-label">Select Image:</label>
                <input type="file" class="form-control" name="image" accept="image/*" onchange="displaySelectedImage(event, 'selectedImage')" required>
            </div>
            <div class="form-group">
                <label for="vertical">Vertical</label>
                <select class="form-control" name="vertical" id="verticalSelect" placeholder="Select Vertical" multiple >
                    {% for vertical in unique_verticals %}
                        <option value="{{ vertical.vertical }}">{{ vertical.vertical }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- <div class="form-group">
                <label for="brand">Keyword</label>
                <textarea class="form-control" name="keywords" id="keywords" placeholder="Write Keywords"></textarea>
            </div> -->

            <div class="form-group">
                <label for="brand">Brand:</label>
                <select class="form-control" name="brand" id="brandSelect" disabled multiple>
                    <option value="" selected disabled>Select Brand</option>
                    <option value="__generic__">Generic Brand</option>  <!-- Add a generic brand option -->
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Search</button>
        </form>

    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- Add Select2 JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

    <script>
        $(document).ready(function() {
        $('#verticalSelect').select2({
            theme: 'bootstrap-5',
            placeholder: "Select Vertical",
            closeOnSelect: false,
        });

        $('#brandSelect').select2({
            theme: 'bootstrap-5',
            placeholder: "Select ",
            closeOnSelect: false,
        }
        );
        
        $('#verticalSelect').change(function() {
            var selectedVertical = $(this).val();
            if (selectedVertical) {
                $('#brandSelect').prop('disabled', false);
                $.ajax({
                    url: '{% url "get_brands_for_vertical" %}',
                    data: {'vertical': selectedVertical.join(',')},
                    dataType: 'json',
                    success: function(data) {
                        // Clear existing options
                        $('#brandSelect').empty();
                        
                        // Add the generic brand option
                        $('#brandSelect').append($('<option>', {
                            value: '',
                            text: 'Generic Brand'
                        }));

                        // Add new options based on data
                        $.each(data.brands, function(index, brand) {
                            $('#brandSelect').append($('<option>', {
                                value: brand,
                                text: brand
                            }));
                        });
                    },
                    error: function(error) {
                        console.log(error);
                    }
                });
            } else {
                $('#brandSelect').prop('disabled', true);
                $('#brandSelect').val('').change();
            }
        });
        
        // Handle form submission
        $('#searchForm').submit(function() {
            var selectedBrand = $('#brandSelect').val();
            
            // Check if the selected brand is the generic brand
            if (selectedBrand === '__generic__') {
                // Do something for the generic brand (e.g., search among items without a brand)
                // Add your logic here
            }
        });

        function displaySelectedImage(event, elementId) {
            const selectedImage = document.getElementById(elementId);
            const fileInput = event.target;

            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();

                reader.onload = function(e) {
                    selectedImage.src = e.target.result;
                };

                reader.readAsDataURL(fileInput.files[0]);
            }
        }
    });

        function displaySelectedImage(event, elementId) {
        const selectedImage = document.getElementById(elementId);
        const fileInput = event.target;

        if (fileInput.files && fileInput.files[0]) {
            const reader = new FileReader();

            reader.onload = function(e) {
                selectedImage.src = e.target.result;
            };

            reader.readAsDataURL(fileInput.files[0]);
        }
    }
    </script>
</body>


{% endblock %}
